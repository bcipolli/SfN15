

<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"></script>
		<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
		<script src="scripts/box.js"></script>
		<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
	
	</head>
	<body ng-app="visApp"> 
		<div ng-controller="visAppController">
    <div id="r0" class="xtkBox"></div>
		  <!-- the sidebar -->
	  <div class="logoBox" id="logoBox">
	    <center>
			<h1>Mindboggle</h1>
			Selected Label: {{selected}}
			
	    </center>
	    
	    
	    
	  </div>
		</div>

	</body>
	
	<style>
		html, body { 
		  background-color:#000;
		  margin: 0;
		  padding: 0;
		  height: 100%;
		  width:100%;
		  overflow: hidden !important;  
		}
		
	</style>
	
	<style type="text/css">
		body {
		  font-family: sans-serif;
		  margin-top: 0px;
		  margin-left: 0px;
		}
		
		div.logoBox {
		  background-color: #000;
		  color: white;
		  width: 30%;
		  float: right;
		  margin-bottom: 10px;
		}
		
		div.xtkBox {
			width:70%;
			height:100%;
			float:left;
			background-color: black;
			
		}
	</style>    
	
	<style>
		
		.box {
				  font: 10px sans-serif;
				}
				
				.box text {fill:white;}
				.box line,
				.box rect,
				.box circle {
				  fill: steelblue;
				  stroke: white;
				  stroke-width: 1px;
				}
				
				.box .center {
				  stroke-dasharray: 3,3;
				  fill: white;
				  stroke: white;
				}
				
				.box .outlier {
				  fill: none;
				  stroke: white;
				  
				}
				
				.axis {
				  font: 12px sans-serif;
				}
				 
				.axis path,
				.axis line {
				  fill: none;
				  stroke: white;
				  shape-rendering: crispEdges;
				}
				 
				.x.axis path { 
				  fill: none;
				  stroke: white;
				  shape-rendering: crispEdges;
				}

		
	</style>
	
		
	<script type="text/javascript" src="http://get.goXTK.com/xtk.js"></script>
	<script src="http://get.goxtk.com/xtk_xdat.gui.js"></script>
	<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>-->

	<script type="text/javascript">
		angular.module('visApp', [])
  .controller('visAppController', function($scope) {
	  
	  	$scope.selected = null;
		var r = new X.renderer3D();
		r.container = 'r0'
		r.init();
        var objects = []



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1001.vtk"
        mesh.color = [0.811433596468,0.158841322386,0.69604381291]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1002.vtk"
        mesh.color = [0.143082478993,0.0755955853522,0.467230765599]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1003.vtk"
        mesh.color = [0.930588972367,0.430772610967,0.901859955432]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1005.vtk"
        mesh.color = [0.585469746863,0.482703588736,0.838742711553]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1006.vtk"
        mesh.color = [0.243898045967,0.930419179435,0.314057762961]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1007.vtk"
        mesh.color = [0.137117951043,0.378620284839,0.412081913526]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1008.vtk"
        mesh.color = [0.392368930298,0.394304070334,0.617453444691]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1009.vtk"
        mesh.color = [0.660188779505,0.401046133818,0.765334009175]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1010.vtk"
        mesh.color = [0.251759916216,0.563222922047,0.403175675368]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1011.vtk"
        mesh.color = [0.96779481175,0.349572905781,0.344820364291]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1012.vtk"
        mesh.color = [0.410904073069,0.859358386591,0.453509112454]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1013.vtk"
        mesh.color = [0.417263639502,0.119592988657,0.50214176081]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1014.vtk"
        mesh.color = [0.62490915995,0.868203636592,0.163559770135]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1015.vtk"
        mesh.color = [0.860610860159,0.850231952776,0.232742432749]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1016.vtk"
        mesh.color = [0.712144294762,0.189110193159,0.262238296394]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1017.vtk"
        mesh.color = [0.138024838895,0.10539467988,0.0871820321659]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1018.vtk"
        mesh.color = [0.202727763486,0.095765659914,0.916492906959]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1019.vtk"
        mesh.color = [0.394011682658,0.870255630427,0.832026961803]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1020.vtk"
        mesh.color = [0.157722083161,0.264511754134,0.298874331306]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1021.vtk"
        mesh.color = [0.843597215403,0.751458951276,0.97948667166]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1022.vtk"
        mesh.color = [0.711987667504,0.114942937065,0.605806048708]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1023.vtk"
        mesh.color = [0.0546361529409,0.000784739087797,0.85976769589]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1024.vtk"
        mesh.color = [0.365504538088,0.0406893619142,0.500240236959]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1025.vtk"
        mesh.color = [0.743228852225,0.0819084162614,0.580601610995]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1026.vtk"
        mesh.color = [0.128789977816,0.21339910409,0.456074239617]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1027.vtk"
        mesh.color = [0.412386013554,0.980342987646,0.0746874673623]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1028.vtk"
        mesh.color = [0.218083720256,0.496924726538,0.296341445604]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1029.vtk"
        mesh.color = [0.131285072873,0.129935256645,0.58830006228]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1030.vtk"
        mesh.color = [0.12357845338,0.563040978195,0.840344930999]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1031.vtk"
        mesh.color = [0.713762890618,0.0128854460431,0.912036227664]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1032.vtk"
        mesh.color = [0.960954430661,0.0223605575475,0.198555430513]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1033.vtk"
        mesh.color = [0.234166790123,0.494158110874,0.109611379024]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1034.vtk"
        mesh.color = [0.764084005584,0.619589806535,0.465442136397]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_1035.vtk"
        mesh.color = [0.935148054758,0.860150334981,0.431223584064]
		r.add(mesh);
        objects.push(mesh.id)



		mesh = new X.mesh();
		mesh.file = "http://media.mindboggle.info/mbviewer/data/mindboggled/Twins-2-1/shapes/left_exploded/freesurfer_curvature_999.vtk"
        mesh.color = [0.483450025871,0.570070691005,0.85488653375]
		r.add(mesh);
        objects.push(mesh.id)


r.render();

r.interactor.onMouseDown = function(left, middle, right) {
	
	    // only observe right mouse clicks        
	    if (!right) return;
	    $("svg").remove()	
	
	    // grab the current mouse position
	    var _pos = r.interactor.mousePosition;
	
	    // pick the current object
	    var _id = r.pick(_pos[0], _pos[1]);
		
        if (_id > 0){
        
        
        
         for (i=0;i<objects.length;i++){
        
        if (objects[i] != _id){
            r.get(objects[i]).opacity = 0.2
        
            }
        
        }
        
        r.get(_id).opacity = 1
        currentMesh = r.get(_id)
        tmp = currentMesh.file.split("_")
		labelID = tmp[tmp.length-1].split(".vtk")[0]
		

        $scope.selected = labelID
        //console.log("selected an ROI", $scope.selected)
        $scope.doBoxplots(labelID,currentMesh)
        $scope.$apply()
        //addOverlay(currentMesh)
        
        } else{
        
         for (i=0;i<objects.length;i++){
        
            r.get(objects[i]).opacity = 1
        
        }
        
        }
        
       
        		
	    
	    //alert("you clicked!")
	    
	
	}

		
		console.log(r)
		
		//var gui=new dat.GUI();
		//curvguis = []
		
		 /*curvatureFiles = ["area", "freesurfer_convexity_(sulc)",  
                    "freesurfer_curvature", "freesurfer_thickness",
                    "fundus_ID", "geodesic_depth", "label_ID",
                    "mean_curvature",  "sulcus_ID",  "travel_depth"]
                    
		 curvatureTypes = ["area","convexity (sulc)","curvature","thickness",
		                   "fundus","geodesic depth", "label ID", "mean curvature", 
	                       "sulcus ID", "travel depth"]*/
  
  
  //['lh.smoothwm.C.crv', 'lh.smoothwm.K1.crv',
                    //'lh.smoothwm.H.crv'];
  
  // we need this Loader as a container to keep track of the current curvature
  var _loader = {
    
    // default type
    Type: 'geodesic depth'
  
  };

		
		var addOverlay = function(mesh){
			tmp = mesh.file.split("_")
			labelID = tmp[tmp.length-1].split(".vtk")[0]
			console.log(labelID)
						
			var curvgui = gui.addFolder('Curvature '+ labelID);
			// a combobox for the different curvature types
			var typeController = curvgui.add(_loader, 'Type', curvatureTypes);
			// the min and max color which define the linear gradient mapping
			var minColorController = curvgui.addColor(mesh.scalars, 'minColor');
			var maxColorController = curvgui.addColor(mesh.scalars, 'maxColor');
			// controllers to threshold the scalars
			var minThresholdController = curvgui.add(mesh.scalars, 'lowerThreshold',
			    mesh.scalars.min, mesh.scalars.max);
			var maxThresholdController = curvgui.add(mesh.scalars, 'upperThreshold',
			    mesh.scalars.min, mesh.scalars.max);
			curvgui.open();
			curvguis.push(curvgui)
			
			
			    typeController.onChange(function(value) {

				      var _index = curvatureTypes.indexOf(value);
				      
				      // we need to buffer the (maybe changed) colors
				      // else wise we would start with the default red<->green mapping
				      var oldMinColor = mesh.scalars.minColor;
				      var oldMaxColor = mesh.scalars.maxColor;
				      
				      // now we (re-)load the selected curvature file
				      fname = 'http://media.mindboggle.info/mbviewer/notebooks/' + curvatureFiles[_index] + "_" + labelID + ".crv";
				      console.log(fname)
				      mesh.scalars.file = fname
				      mesh.modified();
				      
				      mesh.scalars.minColor = oldMinColor;
				      mesh.scalars.maxColor = oldMaxColor;
				      
				    });	
				    };

			
	
	$scope.doBoxplots = function(labelID,mesh){
		console.log("doing boxplots")
		
		var labels = true; // show the text labels beside individual boxplots?
		var color = mesh.color
		
		function componentToHex(c) {
		    var hex = c.toString(16);
		    return hex.length == 1 ? "0" + hex : hex;
		}
		
		function rgbToHex(r, g, b) {
		    return "#" + componentToHex(parseInt(r*255)) + componentToHex(parseInt(g*255)) + componentToHex(parseInt(b*255));
		}
		
		//console.log(color)
		rgbColor = rgbToHex(color[0],color[1],color[2])
		
		
		
		var margin = {top: 30, right: 50, bottom: 70, left: 50};
		var  width = 400 - margin.left - margin.right;
		var height = 300 - margin.top - margin.bottom;
		  
		var min = Infinity,
		    max = -Infinity;
		    
		filename = "data/mindboggled/Twins-2-1/tables/left_exploded_tables/"+labelID+".0.csv"
		console.log(filename)
		// parse in the data  
		d3.csv(filename, function(error, csv) {
		//d3.csv("data/data.csv", function(error, csv) {
		  // using an array of arrays with
		  // data[n][2] 
		  // where n = number of columns in the csv file 
		  // data[i][0] = name of the ith column
		  // data[i][1] = array of values of ith column
		
		  var data = [];
		  data[0] = [];
		  data[1] = [];
		  data[2] = [];
		  data[3] = [];
		  data[4] = [];
		  // add more rows if your csv file has more columns
		
		  // add here the header of the csv file
		  data[0][0] = "travel";
		  data[1][0] = "geodesic";
		  data[2][0] = "mean curv";
		  data[3][0] = "FS curv";
		  data[4][0] = "FS thick";
		  // add more rows if your csv file has more columns
		
		  data[0][1] = [];
		  data[1][1] = [];
		  data[2][1] = [];
		  data[3][1] = [];
		  data[4][1] = [];
		  
		  console.log(csv)
		  csv.forEach(function(x) {
		    var v1 = Math.floor(x.travel_depth),
		      v2 = Math.floor(x.geodesic_depth),
		      v3 = Math.floor(x.mean_curvature),
		      v4 = Math.floor(x.freesurfer_curvature),
		      v5 = Math.floor(x.freesurfer_thickness);
		      // add more variables if your csv file has more columns
		      
		    //var rowMax = Math.max(v1, Math.max(v2, Math.max(v3, Math.max(v4, Math.max(v5,v6)))));
		    //var rowMin = Math.min(v1, Math.min(v2, Math.min(v3, Math.min(v4, Math.min(v5,v6)))));
		    var rowMax = Math.max(v1, Math.max(v2, Math.max(v3, Math.max(v4, v5))));
		    var rowMin = Math.min(v1, Math.min(v2, Math.min(v3, Math.min(v4, v5))));
		
		    data[0][1].push(v1);
		    data[1][1].push(v2);
		    data[2][1].push(v3);
		    data[3][1].push(v4);
		    data[4][1].push(v5);
		     // add more rows if your csv file has more columns
		     
		    if (rowMax > max) max = rowMax;
		    if (rowMin < min) min = rowMin; 
		
		  });
		  
		  var chart = d3.box()
		    .whiskers(iqr(1.5))
		    .height(height) 
		    .domain([min, max])
		    .showLabels(labels);
		
		  var svg = d3.select("#logoBox").append("svg")
		    .attr("width", width + margin.left + margin.right)
		    .attr("height", height + margin.top + margin.bottom)
		    .attr("class", "box")    
		    .append("g")
		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		  
		  // the x-axis
		  var x = d3.scale.ordinal()     
		    .domain( data.map(function(d) { console.log(d); return d[0] } ) )     
		    .rangeRoundBands([0 , width], 0.7, 0.3);    
		
		  var xAxis = d3.svg.axis()
		    .scale(x)
		    .orient("bottom");
		
		  // draw the boxplots  
		  svg.selectAll(".box")    
		      .data(data)
		    .enter().append("g")
		    .attr("transform", function(d) { return "translate(" +  x(d[0])  + "," + margin.top + ")"; } )
		      .call(chart.width(x.rangeBand())); 
		  
		        
		  // add a title
		  svg.append("text")
		        .attr("x", (width / 2))             
		        .attr("y", 0 + (margin.top / 2))
		        .attr("text-anchor", "middle")  
		        .style("font-size", "18px") 
		        //.style("text-decoration", "underline")  
		        .text("Shape distributions");
		
		  // draw x axis  
		  svg.append("g")
		      .attr("class", "x axis")
		      .attr("transform", "translate(0," + (height  + margin.top + 10) + ")")
		      .call(xAxis)
		    .append("text")             // text label for the x axis
		        .attr("x", (width / 2) )
		        .attr("y",  10 )
		    .attr("dy", ".71em")
		        .style("text-anchor", "middle")
		    .style("font-size", "16px") 
		    
		  $("rect").css("fill",rgbColor)
		  console.log("set color?")
		  
		});
		
		// Returns a function to compute the interquartile range.
		function iqr(k) {
		  return function(d, i) {
		    var q1 = d.quartiles[0],
		        q3 = d.quartiles[2],
		        iqr = (q3 - q1) * k,
		        i = -1,
		        j = d.length;
		    while (d[++i] < q1 - iqr);
		    while (d[--j] > q3 + iqr);
		    return [i, j];
		  };
		}

		
	}
		



});
</script>
	
	
</html>
